
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Discover features of Netzob &#8212; Netzob Documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/zoby.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Netzob Documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Netzob documentation
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Installation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../installation/python.html">
   Installation of Netzob
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Protocol Modelization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../language_specification/dataspec.html">
   Format Message Modeling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../language_specification/statemachinespec.html">
   State Machine Modeling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../language_specification/protospec.html">
   Protocol Modeling
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Traffic Generation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../language_specification/trafficgeneration.html">
   Sending and Receiving Messages
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../language_specification/actor.html">
   Visiting a State Machine with an Actor
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Fuzzing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../language_specification/fuzzing.html">
   Fuzzing Message Format
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../language_specification/fuzzing_automata.html">
   Fuzzing Automata
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/tutorials/discover_features.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#retrieve-netzob-and-resources">
   Retrieve Netzob and resources.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-messages-from-a-pcap-file">
   Import messages from a PCAP file.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regroup-messages-in-a-symbol-and-do-a-format-partitionment-with-a-delimiter">
   Regroup messages in a symbol and do a format partitionment with a delimiter
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cluster-according-to-a-key-field">
   Cluster according to a key field
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#apply-a-format-partitionment-with-a-sequence-alignment-on-the-third-field-of-each-symbol">
   Apply a format partitionment with a sequence alignment on the third field of each symbol
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#find-field-relations-in-each-symbol">
   Find field relations in each symbol
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#find-relations-and-apply-them-in-the-symbol-structure">
   Find relations and apply them in the symbol structure
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generate-a-chained-states-automaton">
   Generate a chained states automaton
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generate-a-one-state-automaton">
   Generate a one state automaton
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generate-a-pta-based-automaton">
   Generate a PTA-based automaton
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generate-messages-according-to-the-inferred-model">
   Generate messages according to the inferred model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#do-some-fuzzing-on-a-specific-symbol">
   Do some fuzzing on a specific symbol
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Discover features of Netzob</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#retrieve-netzob-and-resources">
   Retrieve Netzob and resources.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-messages-from-a-pcap-file">
   Import messages from a PCAP file.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regroup-messages-in-a-symbol-and-do-a-format-partitionment-with-a-delimiter">
   Regroup messages in a symbol and do a format partitionment with a delimiter
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cluster-according-to-a-key-field">
   Cluster according to a key field
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#apply-a-format-partitionment-with-a-sequence-alignment-on-the-third-field-of-each-symbol">
   Apply a format partitionment with a sequence alignment on the third field of each symbol
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#find-field-relations-in-each-symbol">
   Find field relations in each symbol
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#find-relations-and-apply-them-in-the-symbol-structure">
   Find relations and apply them in the symbol structure
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generate-a-chained-states-automaton">
   Generate a chained states automaton
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generate-a-one-state-automaton">
   Generate a one state automaton
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generate-a-pta-based-automaton">
   Generate a PTA-based automaton
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generate-messages-according-to-the-inferred-model">
   Generate messages according to the inferred model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#do-some-fuzzing-on-a-specific-symbol">
   Do some fuzzing on a specific symbol
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="discover-features-of-netzob">
<span id="discover-features"></span><h1>Discover features of Netzob<a class="headerlink" href="#discover-features-of-netzob" title="Permalink to this headline">#</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This tutorial for Netzob 1.x is currently slighlty obsolete, and should be updated to the Netzob API 2.x.</p>
</div>
<p>This tutorial presents the main features of Netzob regarding the
inference of message formats and grammar of a simple toy protocol. The
described features cover the following capabilities:</p>
<ul class="simple">
<li><p>Import of a PCAP file</p></li>
<li><p>Format message inference</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>Partitionment of messages following a specific delimiter</p></li>
<li><p>Regroupment of messages following a specific key field</p></li>
<li><p>Partitionment of a subset a each message following a sequence aligment</p></li>
<li><p>Search for relationships in each group of messages</p></li>
<li><p>Modification of the format message to apply found relationships</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>Grammar inference</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>Generation of an automaton with one main state according to a captured sequence of messages</p></li>
<li><p>Generation of an automaton with a sequence of states according to a captured sequence of messages</p></li>
<li><p>Generation of a Prefix Tree Acceptor (PTA) automaton according to a captured sequence of messages</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>Traffic generation and fuzzing</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>Generation of messages following the inferred message format of each group and through visiting the inferred automata</p></li>
<li><p>Fuzzing of an implementation by generating altered message formats</p></li>
</ul>
</div></blockquote>
<section id="retrieve-netzob-and-resources">
<h2>Retrieve Netzob and resources.<a class="headerlink" href="#retrieve-netzob-and-resources" title="Permalink to this headline">#</a></h2>
<p>At first, retrieve the source code of Netzob:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://dev.netzob.org/git/netzob
</pre></div>
</div>
<p>Then, you can retrieve the source code of the toy protocol implementation used in this tutorial, as well as some PCAP files of sequences of messages.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://dev.netzob.org/attachments/download/179/tutorial_netzob_v1.tar.gz">Toy protocol implementation</a></p></li>
<li><p><a class="reference external" href="https://dev.netzob.org/attachments/download/182/target_src_v1_session1.pcap">PCAP of sequence 1</a></p></li>
<li><p><a class="reference external" href="https://dev.netzob.org/attachments/download/181/target_src_v1_session2.pcap">PCAP of sequence 2</a></p></li>
<li><p><a class="reference external" href="https://dev.netzob.org/attachments/download/180/target_src_v1_session3.pcap">PCAP of sequence 3</a></p></li>
</ul>
</section>
<section id="import-messages-from-a-pcap-file">
<h2>Import messages from a PCAP file.<a class="headerlink" href="#import-messages-from-a-pcap-file" title="Permalink to this headline">#</a></h2>
<p>Reading packets from a PCAP file is done through the PCAPImporter.readFile() static function. This function can optionally take more parameters to specify a BPF filter, the import layer or the number of packets to capture:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">netzob.all</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">messages_session1</span> <span class="o">=</span> <span class="n">PCAPImporter</span><span class="o">.</span><span class="n">readFile</span><span class="p">(</span><span class="s2">&quot;target_src_v1_session1.pcap&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="n">messages_session2</span> <span class="o">=</span> <span class="n">PCAPImporter</span><span class="o">.</span><span class="n">readFile</span><span class="p">(</span><span class="s2">&quot;target_src_v1_session2.pcap&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

<span class="n">messages</span> <span class="o">=</span> <span class="n">messages_session1</span> <span class="o">+</span> <span class="n">messages_session2</span>

<span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<p>The output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">1388154953.32</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">57831</span><span class="o">-&gt;</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4242</span><span class="p">]</span> <span class="s1">&#39;CMDidentify#</span><span class="se">\x07\x00\x00\x00</span><span class="s1">Roberto&#39;</span>
<span class="p">[</span><span class="mf">1388154953.32</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4242</span><span class="o">-&gt;</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">57831</span><span class="p">]</span> <span class="s1">&#39;RESidentify#</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s1">&#39;</span>
<span class="p">[</span><span class="mf">1388154953.32</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">57831</span><span class="o">-&gt;</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4242</span><span class="p">]</span> <span class="s1">&#39;CMDinfo#</span><span class="se">\x00\x00\x00\x00</span><span class="s1">&#39;</span>
<span class="p">[</span><span class="mf">1388154953.32</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4242</span><span class="o">-&gt;</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">57831</span><span class="p">]</span> <span class="s1">&#39;RESinfo#</span><span class="se">\x00\x00\x00\x00\x04\x00\x00\x00</span><span class="s1">info&#39;</span>
<span class="p">[</span><span class="mf">1388154953.32</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">57831</span><span class="o">-&gt;</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4242</span><span class="p">]</span> <span class="s1">&#39;CMDstats#</span><span class="se">\x00\x00\x00\x00</span><span class="s1">&#39;</span>
<span class="p">[</span><span class="mf">1388154953.32</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4242</span><span class="o">-&gt;</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">57831</span><span class="p">]</span> <span class="s1">&#39;RESstats#</span><span class="se">\x00\x00\x00\x00\x05\x00\x00\x00</span><span class="s1">stats&#39;</span>
<span class="p">[</span><span class="mf">1388154953.32</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">57831</span><span class="o">-&gt;</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4242</span><span class="p">]</span> <span class="s1">&#39;CMDauthentify#</span><span class="se">\n\x00\x00\x00</span><span class="s1">aStrongPwd&#39;</span>
<span class="p">[</span><span class="mf">1388154953.32</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4242</span><span class="o">-&gt;</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">57831</span><span class="p">]</span> <span class="s1">&#39;RESauthentify#</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s1">&#39;</span>
<span class="p">[</span><span class="mf">1388154953.32</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">57831</span><span class="o">-&gt;</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4242</span><span class="p">]</span> <span class="s1">&#39;CMDencrypt#</span><span class="se">\x06\x00\x00\x00</span><span class="s1">abcdef&#39;</span>
<span class="p">[</span><span class="mf">1388154953.32</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4242</span><span class="o">-&gt;</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">57831</span><span class="p">]</span> <span class="s2">&quot;RESencrypt#</span><span class="se">\x00\x00\x00\x00\x06\x00\x00\x00</span><span class="s2">$ !&amp;&#39;$&quot;</span>
<span class="p">[</span><span class="mf">1388154953.32</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">57831</span><span class="o">-&gt;</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4242</span><span class="p">]</span> <span class="s2">&quot;CMDdecrypt#</span><span class="se">\x06\x00\x00\x00</span><span class="s2">$ !&amp;&#39;$&quot;</span>
<span class="p">[</span><span class="mf">1388154953.32</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4242</span><span class="o">-&gt;</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">57831</span><span class="p">]</span> <span class="s1">&#39;RESdecrypt#</span><span class="se">\x00\x00\x00\x00\x06\x00\x00\x00</span><span class="s1">abcdef&#39;</span>
<span class="p">[</span><span class="mf">1388154953.33</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">57831</span><span class="o">-&gt;</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4242</span><span class="p">]</span> <span class="s1">&#39;CMDbye#</span><span class="se">\x00\x00\x00\x00</span><span class="s1">&#39;</span>
<span class="p">[</span><span class="mf">1388154953.33</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4242</span><span class="o">-&gt;</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">57831</span><span class="p">]</span> <span class="s1">&#39;RESbye#</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s1">&#39;</span>
<span class="p">[</span><span class="mf">1388154953.31</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">57831</span><span class="o">-&gt;</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4242</span><span class="p">]</span> <span class="s1">&#39;CMDidentify#</span><span class="se">\x04\x00\x00\x00</span><span class="s1">fred&#39;</span>
<span class="p">[</span><span class="mf">1388154953.31</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4242</span><span class="o">-&gt;</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">57831</span><span class="p">]</span> <span class="s1">&#39;RESidentify#</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s1">&#39;</span>
<span class="p">[</span><span class="mf">1388154953.31</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">57831</span><span class="o">-&gt;</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4242</span><span class="p">]</span> <span class="s1">&#39;CMDinfo#</span><span class="se">\x00\x00\x00\x00</span><span class="s1">&#39;</span>
<span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="regroup-messages-in-a-symbol-and-do-a-format-partitionment-with-a-delimiter">
<h2>Regroup messages in a symbol and do a format partitionment with a delimiter<a class="headerlink" href="#regroup-messages-in-a-symbol-and-do-a-format-partitionment-with-a-delimiter" title="Permalink to this headline">#</a></h2>
<p>According to a quick review of the displayed messages, the character ‘#’ sounds interesting as i appears in the middle of each message. So let’s use it as a delimiter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbol</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">)</span>

<span class="n">Format</span><span class="o">.</span><span class="n">splitDelimiter</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">ASCII</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Symbol structure:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">symbol</span><span class="o">.</span><span class="n">_str_debug</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Partitionned messages:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
</pre></div>
</div>
<p>We now obtain the following symbol (i.e. our goup of messages) structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Symbol</span> <span class="n">structure</span><span class="p">:</span>
<span class="n">Symbol</span>
<span class="o">|--</span>  <span class="n">Field</span><span class="o">-</span><span class="mi">0</span>
   <span class="o">|--</span>   <span class="n">Alt</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;RESstats&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;RESauthentify&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">104</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;RESidentify&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">88</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;CMDstats&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;CMDdecrypt&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;CMDauthentify&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">104</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;RESdecrypt&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;RESinfo&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">56</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;CMDinfo&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">56</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;RESauthentify&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">104</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;CMDencrypt&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;CMDauthentify&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">104</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;CMDstats&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;RESbye&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">48</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;RESdecrypt&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;RESencrypt&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;CMDidentify&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">88</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;CMDbye&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">48</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;RESinfo&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">56</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;RESencrypt&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;RESidentify&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">88</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;CMDidentify&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">88</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;CMDencrypt&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;RESbye&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">48</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;CMDinfo&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">56</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;CMDbye&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">48</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;CMDdecrypt&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;RESstats&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">)))</span>
<span class="o">|--</span>  <span class="n">Field</span><span class="o">-</span><span class="n">sep</span><span class="o">-</span><span class="mi">23</span>
   <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">ASCII</span><span class="o">=</span><span class="c1"># ((0, 8)))</span>
<span class="o">|--</span>  <span class="n">Field</span><span class="o">-</span><span class="mi">2</span>
   <span class="o">|--</span>   <span class="n">Alt</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x04\x00\x00\x00</span><span class="s1">fred&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s1">&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x05\x00\x00\x00</span><span class="s1">stats&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">104</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\x00\x00\x00</span><span class="s1">aStrongPwd&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">112</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s1">&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00</span><span class="s1">&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s1">&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s1">&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00</span><span class="s1">&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x06\x00\x00\x00</span><span class="s1">abcdef&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x04\x00\x00\x00</span><span class="s1">info&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">96</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\x00\x00\x00</span><span class="s1">123456test&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">112</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s1">&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\n\x00\x00\x00</span><span class="s1">123456test&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">144</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x07\x00\x00\x00</span><span class="s1">Roberto&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">88</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x06\x00\x00\x00</span><span class="s2">$ !&amp;&#39;$&quot;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">112</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\n\x00\x00\x00</span><span class="s2">spqvwt6&#39;16&quot;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">144</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\x06\x00\x00\x00</span><span class="s2">$ !&amp;&#39;$&quot;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x05\x00\x00\x00</span><span class="s1">stats&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">104</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00</span><span class="s1">&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\x00\x00\x00</span><span class="s2">spqvwt6&#39;16&quot;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">112</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t\x00\x00\x00</span><span class="s1">myPasswd!&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">104</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00</span><span class="s1">&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x04\x00\x00\x00</span><span class="s1">info&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">96</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x06\x00\x00\x00</span><span class="s1">abcdef&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">112</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00</span><span class="s1">&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00</span><span class="s1">&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">)))</span>
         <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s1">&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">)))</span>
</pre></div>
</div>
<p>Regarding the partitioned messages, this now looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;bash&quot;</span><span class="o">&gt;</span>
<span class="s1">&#39;CMDidentify&#39;</span>   <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s1">&#39;</span><span class="se">\x07\x00\x00\x00</span><span class="s1">Roberto&#39;</span>
<span class="s1">&#39;RESidentify&#39;</span>   <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s1">&#39;</span>
<span class="s1">&#39;CMDinfo&#39;</span>       <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00</span><span class="s1">&#39;</span>
<span class="s1">&#39;RESinfo&#39;</span>       <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x04\x00\x00\x00</span><span class="s1">info&#39;</span>
<span class="s1">&#39;CMDstats&#39;</span>      <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00</span><span class="s1">&#39;</span>
<span class="s1">&#39;RESstats&#39;</span>      <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x05\x00\x00\x00</span><span class="s1">stats&#39;</span>
<span class="s1">&#39;CMDauthentify&#39;</span> <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s1">&#39;</span><span class="se">\n\x00\x00\x00</span><span class="s1">aStrongPwd&#39;</span>
<span class="s1">&#39;RESauthentify&#39;</span> <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s1">&#39;</span>
<span class="s1">&#39;CMDencrypt&#39;</span>    <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s1">&#39;</span><span class="se">\x06\x00\x00\x00</span><span class="s1">abcdef&#39;</span>
<span class="s1">&#39;RESencrypt&#39;</span>    <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x06\x00\x00\x00</span><span class="s2">$ !&amp;&#39;$&quot;</span>
<span class="s1">&#39;CMDdecrypt&#39;</span>    <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s2">&quot;</span><span class="se">\x06\x00\x00\x00</span><span class="s2">$ !&amp;&#39;$&quot;</span>
<span class="s1">&#39;RESdecrypt&#39;</span>    <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x06\x00\x00\x00</span><span class="s1">abcdef&#39;</span>
<span class="s1">&#39;CMDbye&#39;</span>        <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00</span><span class="s1">&#39;</span>
<span class="s1">&#39;RESbye&#39;</span>        <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s1">&#39;</span>
<span class="s1">&#39;CMDidentify&#39;</span>   <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s1">&#39;</span><span class="se">\x04\x00\x00\x00</span><span class="s1">fred&#39;</span>
<span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="cluster-according-to-a-key-field">
<h2>Cluster according to a key field<a class="headerlink" href="#cluster-according-to-a-key-field" title="Permalink to this headline">#</a></h2>
<p>The first field seems interesting, as it contains some kind of commands (‘CMDencrypt’, ‘CMDidentify’, etc.). Let’s thus cluster the symbol according to the first field:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbols</span> <span class="o">=</span> <span class="n">Format</span><span class="o">.</span><span class="n">clusterByKeyField</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">symbol</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Number of symbols after clustering: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Symbol list:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">keyFieldName</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  * </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keyFieldName</span><span class="p">))</span>
</pre></div>
</div>
<p>The clustering algorithm produces 14 different symbols, where each symbol has a uniq value in the first field.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">symbols</span> <span class="n">after</span> <span class="n">clustering</span><span class="p">:</span> <span class="mi">14</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Symbol</span> <span class="nb">list</span><span class="p">:</span>
  <span class="o">*</span> <span class="n">RESdecrypt</span>
  <span class="o">*</span> <span class="n">RESbye</span>
  <span class="o">*</span> <span class="n">RESidentify</span>
  <span class="o">*</span> <span class="n">CMDbye</span>
  <span class="o">*</span> <span class="n">RESencrypt</span>
  <span class="o">*</span> <span class="n">CMDidentify</span>
  <span class="o">*</span> <span class="n">RESstats</span>
  <span class="o">*</span> <span class="n">CMDencrypt</span>
  <span class="o">*</span> <span class="n">RESauthentify</span>
  <span class="o">*</span> <span class="n">CMDdecrypt</span>
  <span class="o">*</span> <span class="n">CMDinfo</span>
  <span class="o">*</span> <span class="n">CMDauthentify</span>
  <span class="o">*</span> <span class="n">RESinfo</span>
  <span class="o">*</span> <span class="n">CMDstats</span>
</pre></div>
</div>
</section>
<section id="apply-a-format-partitionment-with-a-sequence-alignment-on-the-third-field-of-each-symbol">
<h2>Apply a format partitionment with a sequence alignment on the third field of each symbol<a class="headerlink" href="#apply-a-format-partitionment-with-a-sequence-alignment-on-the-third-field-of-each-symbol" title="Permalink to this headline">#</a></h2>
<p>As the last field seems to have a dynamic size, let’s have a look at what would provide a sequence alignment (i.e. a means to align static and dynamic sub-fields):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">Format</span><span class="o">.</span><span class="n">splitAligned</span><span class="p">(</span><span class="n">symbol</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">doInternalSlick</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Partitionned messages:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
</pre></div>
</div>
<p>For the symbol ‘CMDencrypt’, the sequence alignment of the last field produces the following format, where we can observe a static field of ‘x00x00x00’ surrounded by two variable fields. The last field seems to be the buffer we want to encrypt, as the key field name suggest (i.e. ‘CMDencrypt’).:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Partitionned</span> <span class="n">messages</span><span class="p">:</span>
<span class="s1">&#39;CMDencrypt&#39;</span> <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>   <span class="o">|</span> <span class="s1">&#39;</span><span class="se">\x00\x00\x00</span><span class="s1">&#39;</span> <span class="o">|</span> <span class="s1">&#39;123456test&#39;</span>
<span class="s1">&#39;CMDencrypt&#39;</span> <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s1">&#39;</span><span class="se">\x06</span><span class="s1">&#39;</span> <span class="o">|</span> <span class="s1">&#39;</span><span class="se">\x00\x00\x00</span><span class="s1">&#39;</span> <span class="o">|</span> <span class="s1">&#39;abcdef&#39;</span>
<span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="find-field-relations-in-each-symbol">
<h2>Find field relations in each symbol<a class="headerlink" href="#find-field-relations-in-each-symbol" title="Permalink to this headline">#</a></h2>
<p>Let’s now find any relationships is those messages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">rels</span> <span class="o">=</span> <span class="n">RelationFinder</span><span class="o">.</span><span class="n">findOnSymbol</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Relations found: &quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">rels</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  &quot;</span> <span class="o">+</span> <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;relation_type&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;, between &#39;&quot;</span> <span class="o">+</span> <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;x_attribute&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39; of:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;x_fields&quot;</span><span class="p">]])))</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">getValues</span><span class="p">()[:]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;x_fields&quot;</span><span class="p">]]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  &quot;</span> <span class="o">+</span> <span class="s2">&quot;and &#39;&quot;</span> <span class="o">+</span> <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;y_attribute&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39; of:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;y_fields&quot;</span><span class="p">]])))</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">getValues</span><span class="p">()[:]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;y_fields&quot;</span><span class="p">]]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</pre></div>
</div>
<p>In the symbol ‘CMDencrypt’, we have found a relationship between the content of a field (the third one) and the length of another field (the last one, which presumably contains the buffer we want to encrypt).:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Relations</span> <span class="n">found</span><span class="p">:</span>
  <span class="n">SizeRelation</span><span class="p">,</span> <span class="n">between</span> <span class="s1">&#39;value&#39;</span> <span class="n">of</span><span class="p">:</span>
    <span class="n">Field</span>
    <span class="p">[[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x06</span><span class="s1">&#39;</span><span class="p">]]</span>
  <span class="ow">and</span> <span class="s1">&#39;size&#39;</span> <span class="n">of</span><span class="p">:</span>
    <span class="n">Field</span>
    <span class="p">[[</span><span class="s1">&#39;123456test&#39;</span><span class="p">,</span> <span class="s1">&#39;abcdef&#39;</span><span class="p">]]</span>
<span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="find-relations-and-apply-them-in-the-symbol-structure">
<h2>Find relations and apply them in the symbol structure<a class="headerlink" href="#find-relations-and-apply-them-in-the-symbol-structure" title="Permalink to this headline">#</a></h2>
<p>We then modify the format message to apply the relationship we have just found, by creating a Size field whose value depends on the content of a targeted field. We also specify a factor that basically says that the value of the size field should be one eighth of the size of the buffer field (as every field size is expressed in bits by default):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">rels</span> <span class="o">=</span> <span class="n">RelationFinder</span><span class="o">.</span><span class="n">findOnSymbol</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">rels</span><span class="p">:</span>

        <span class="c1"># Apply first found relationship</span>
        <span class="n">rel</span> <span class="o">=</span> <span class="n">rels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;x_fields&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">Size</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="s2">&quot;y_fields&quot;</span><span class="p">],</span> <span class="n">factor</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mf">8.0</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Symbol structure:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">symbol</span><span class="o">.</span><span class="n">_str_debug</span><span class="p">())</span>
</pre></div>
</div>
<p>The ‘CMDencrypt’ symbol structure now looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Symbol</span> <span class="n">structure</span><span class="p">:</span>
<span class="n">Symbol_CMDencrypt</span>
<span class="o">|--</span>  <span class="n">Field</span><span class="o">-</span><span class="mi">0</span>
   <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">ASCII</span><span class="o">=</span><span class="n">CMDencrypt</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
<span class="o">|--</span>  <span class="n">Field</span><span class="o">-</span><span class="n">sep</span><span class="o">-</span><span class="mi">23</span>
   <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">ASCII</span><span class="o">=</span><span class="c1"># ((0, 8)))</span>
<span class="o">|--</span>  <span class="n">Field</span><span class="o">-</span><span class="mi">2</span>
   <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="kc">None</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)))</span>
<span class="o">|--</span>  <span class="o">|--</span>  <span class="n">Field</span>
        <span class="o">|--</span>   <span class="n">Size</span><span class="p">([</span><span class="s1">&#39;Field&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">Type</span><span class="p">:</span><span class="n">Raw</span><span class="o">=</span><span class="kc">None</span> <span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="o">|--</span>  <span class="o">|--</span>  <span class="n">Field</span>
        <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00</span><span class="s1">&#39;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">)))</span>
<span class="o">|--</span>  <span class="o">|--</span>  <span class="n">Field</span>
        <span class="o">|--</span>   <span class="n">Data</span> <span class="p">(</span><span class="n">Raw</span><span class="o">=</span><span class="kc">None</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
<span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>That is all for the message format inference. Let’s now look at the state machine of this toy protocol.</p>
</section>
<section id="generate-a-chained-states-automaton">
<h2>Generate a chained states automaton<a class="headerlink" href="#generate-a-chained-states-automaton" title="Permalink to this headline">#</a></h2>
<p>We will generate a basic automaton that illustrates the sequence of commands and responses extracted from a PCAP file. For each message sent, this will create a new transition to a new state, thus the name of <em>chained states automaton</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a session of messages</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">messages_session1</span><span class="p">)</span>

<span class="c1"># Abstract this session according to the inferred symbols</span>
<span class="n">abstractSession</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">abstract</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

<span class="c1"># Generate an automata according to the observed sequence of messages/symbols</span>
<span class="n">automata</span> <span class="o">=</span> <span class="n">Automata</span><span class="o">.</span><span class="n">generateChainedStatesAutomata</span><span class="p">(</span><span class="n">abstractSession</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

<span class="c1"># Print the dot representation of the automata</span>
<span class="n">dotcode</span> <span class="o">=</span> <span class="n">automata</span><span class="o">.</span><span class="n">generateDotCode</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dotcode</span><span class="p">)</span>
</pre></div>
</div>
<p>The obtained automaton is finally converted into Dot code in order to render a graphical version of it.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">digraph</span> <span class="n">G</span> <span class="p">{</span>
<span class="s2">&quot;Start state&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">doubleoctagon</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;f8d33b83-d6b0-4180-832c-7cce9d6b3fea&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 1&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;a332ed56-e2d8-4c8c-9ec2-99c5f942e9a3&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 2&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;8f45bd4e-fe03-4a26-bf9a-1adec60f597d&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 3&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;01999e79-de00-467d-987a-e9411d57be99&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 4&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;9b20ed29-77e5-43c1-bb8b-cf3a84674941&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 5&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;52ec3815-656b-421b-bb1f-c4f7746be534&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 6&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;1cbbd123-32d5-4cd8-bd01-4fd3bcd8ae38&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 7&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;8a8ab662-db23-4206-ba35-28396ee31115&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 8&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;ee9e0d5d-bb4e-4d2e-8c97-1553afa1cc68&quot;</span><span class="p">];</span>
<span class="s2">&quot;End state&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;3874e4e9-af5d-428e-92b8-e1fda38b6ef9&quot;</span><span class="p">];</span>
<span class="s2">&quot;Start state&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 1&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;OpenChannelTransition&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;4beecca4-0d48-4ca9-8d83-ffd8766b64c7&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 1&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 2&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDidentify;</span><span class="si">{Symbol_RESidentify}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;c4e5451c-6a53-41f3-9748-7179774eb7de&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 2&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 3&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDinfo;</span><span class="si">{Symbol_RESinfo}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;c4e5451c-6a53-41f3-9748-7179774eb7de&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 3&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 4&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDstats;</span><span class="si">{Symbol_RESstats}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;c4e5451c-6a53-41f3-9748-7179774eb7de&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 4&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 5&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDauthentify;</span><span class="si">{Symbol_RESauthentify}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;c4e5451c-6a53-41f3-9748-7179774eb7de&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 5&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 6&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDencrypt;</span><span class="si">{Symbol_RESencrypt}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;c4e5451c-6a53-41f3-9748-7179774eb7de&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 6&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 7&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDdecrypt;</span><span class="si">{Symbol_RESdecrypt}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;c4e5451c-6a53-41f3-9748-7179774eb7de&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 7&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 8&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDbye;</span><span class="si">{Symbol_RESbye}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;c4e5451c-6a53-41f3-9748-7179774eb7de&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 8&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;End state&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CloseChannelTransition&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;c6ac87b7-5de1-401a-8b75-5d2a73d81264&quot;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<figure class="align-center">
<a class="reference external image-reference" href="https://dev.netzob.org/attachments/download/172/automata_target_v1_chained.svg"><img alt="" src="https://dev.netzob.org/attachments/download/172/automata_target_v1_chained.svg" /></a>
</figure>
</section>
<section id="generate-a-one-state-automaton">
<h2>Generate a one state automaton<a class="headerlink" href="#generate-a-one-state-automaton" title="Permalink to this headline">#</a></h2>
<p>This time, instead of converting a PCAP into a sequence of states for each message observed, we generate a uniq state that accept any of the observed sent messages to trigger a new transition. In response to each sent message (for example ‘CMDencrypt’), we expect a specific response (for example ‘REDencrypt’):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a session of messages</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">messages_session1</span><span class="p">)</span>

<span class="c1"># Abstract this session according to the inferred symbols</span>
<span class="n">abstractSession</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">abstract</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

<span class="c1"># Generate an automata according to the observed sequence of messages/symbols</span>
<span class="n">automata</span> <span class="o">=</span> <span class="n">Automata</span><span class="o">.</span><span class="n">generateOneStateAutomata</span><span class="p">(</span><span class="n">abstractSession</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

<span class="c1"># Print the dot representation of the automata</span>
<span class="n">dotcode</span> <span class="o">=</span> <span class="n">automata</span><span class="o">.</span><span class="n">generateDotCode</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dotcode</span><span class="p">)</span>
</pre></div>
</div>
<p>The obtained automaton is finally converted into Dot code in order to render a graphical version of it.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">digraph</span> <span class="n">G</span> <span class="p">{</span>
<span class="s2">&quot;Start state&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">doubleoctagon</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;0659071e-1849-4616-a11a-e98edfe86e24&quot;</span><span class="p">];</span>
<span class="s2">&quot;Main state&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;424e0a69-da0b-4030-816a-8368e30a00a9&quot;</span><span class="p">];</span>
<span class="s2">&quot;End state&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;9de3d54b-f0eb-45f8-809a-86a60d22812f&quot;</span><span class="p">];</span>
<span class="s2">&quot;Start state&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;Main state&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;OpenChannelTransition&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;3818118b-97db-474f-b9c3-f38c04152a74&quot;</span><span class="p">];</span>
<span class="s2">&quot;Main state&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;Main state&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDidentify;</span><span class="si">{Symbol_RESidentify}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;f6000e04-10a8-41de-a1a0-29021440684a&quot;</span><span class="p">];</span>
<span class="s2">&quot;Main state&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;Main state&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDinfo;</span><span class="si">{Symbol_RESinfo}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;f6000e04-10a8-41de-a1a0-29021440684a&quot;</span><span class="p">];</span>
<span class="s2">&quot;Main state&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;Main state&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDstats;</span><span class="si">{Symbol_RESstats}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;f6000e04-10a8-41de-a1a0-29021440684a&quot;</span><span class="p">];</span>
<span class="s2">&quot;Main state&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;Main state&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDauthentify;</span><span class="si">{Symbol_RESauthentify}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;f6000e04-10a8-41de-a1a0-29021440684a&quot;</span><span class="p">];</span>
<span class="s2">&quot;Main state&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;Main state&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDencrypt;</span><span class="si">{Symbol_RESencrypt}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;f6000e04-10a8-41de-a1a0-29021440684a&quot;</span><span class="p">];</span>
<span class="s2">&quot;Main state&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;Main state&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDdecrypt;</span><span class="si">{Symbol_RESdecrypt}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;f6000e04-10a8-41de-a1a0-29021440684a&quot;</span><span class="p">];</span>
<span class="s2">&quot;Main state&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;Main state&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDbye;</span><span class="si">{Symbol_RESbye}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;f6000e04-10a8-41de-a1a0-29021440684a&quot;</span><span class="p">];</span>
<span class="s2">&quot;Main state&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;End state&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CloseChannelTransition&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;75a4cc3a-72a4-42a3-af2c-aa3939f899aa&quot;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<figure class="align-center">
<a class="reference external image-reference" href="https://dev.netzob.org/attachments/download/173/automata_target_v1_onestate.svg"><img alt="" src="https://dev.netzob.org/attachments/download/173/automata_target_v1_onestate.svg" /></a>
</figure>
</section>
<section id="generate-a-pta-based-automaton">
<h2>Generate a PTA-based automaton<a class="headerlink" href="#generate-a-pta-based-automaton" title="Permalink to this headline">#</a></h2>
<p>Finally, we convert multiple sequences of messages taken form different PCAP files to generate an automaton for which we have merge identical paths. The underlying merging strategy is called a Prefix-Tree Acceptor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create sessions of messages</span>
<span class="n">messages_session1</span> <span class="o">=</span> <span class="n">PCAPImporter</span><span class="o">.</span><span class="n">readFile</span><span class="p">(</span><span class="s2">&quot;target_src_v1_session1.pcap&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="n">messages_session3</span> <span class="o">=</span> <span class="n">PCAPImporter</span><span class="o">.</span><span class="n">readFile</span><span class="p">(</span><span class="s2">&quot;target_src_v1_session3.pcap&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

<span class="n">session1</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">messages_session1</span><span class="p">)</span>
<span class="n">session3</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">messages_session3</span><span class="p">)</span>

<span class="c1"># Abstract this session according to the inferred symbols</span>
<span class="n">abstractSession1</span> <span class="o">=</span> <span class="n">session1</span><span class="o">.</span><span class="n">abstract</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">abstractSession3</span> <span class="o">=</span> <span class="n">session3</span><span class="o">.</span><span class="n">abstract</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

<span class="c1"># Generate an automata according to the observed sequence of messages/symbols</span>
<span class="n">automata</span> <span class="o">=</span> <span class="n">Automata</span><span class="o">.</span><span class="n">generatePTAAutomata</span><span class="p">([</span><span class="n">abstractSession1</span><span class="p">,</span> <span class="n">abstractSession3</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

<span class="c1"># Print the dot representation of the automata</span>
<span class="n">dotcode</span> <span class="o">=</span> <span class="n">automata</span><span class="o">.</span><span class="n">generateDotCode</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dotcode</span><span class="p">)</span>
</pre></div>
</div>
<p>The obtained automaton is finally converted into Dot code in order to render a graphical version of it.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">digraph</span> <span class="n">G</span> <span class="p">{</span>
<span class="s2">&quot;Start state&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">doubleoctagon</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;e46d8a67-2a96-479a-9234-c1b38c75b847&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 0&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;0cd8a2c9-4410-45a0-9950-6456546f49dc&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 1&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;bbc10d50-f197-40f6-a674-5f80790ef954&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 2&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;739801b7-9e0d-4fba-a4f5-cf130e6b7fbf&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 3&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;c2075b80-16b9-4bd7-b290-6eb333f94e43&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 4&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;715ede75-d81e-46ea-a7c1-f537e5dba892&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 9&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;ad5873af-c26a-482f-94d9-0cf47c69376b&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 10&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;01859f7d-6b43-45af-8c17-9decb10dea9b&quot;</span><span class="p">];</span>
<span class="s2">&quot;End state 11&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;7f4bd693-a35f-479b-8e86-128dc46c71cf&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 5&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;ee9da65c-b072-4344-bf71-2d67a3b73880&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 6&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;902e76e4-6a9a-45a2-95ba-ae9484f1084f&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 7&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;f7e9b27a-6879-4b4f-bb51-00530f07addf&quot;</span><span class="p">];</span>
<span class="s2">&quot;End state 8&quot;</span> <span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;fe710eed-287f-4abf-93bf-6878e487d8a9&quot;</span><span class="p">];</span>
<span class="s2">&quot;Start state&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 0&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;OpenChannelTransition&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;5d6139d0-9b1c-49b2-b19d-91ae8c56f299&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 0&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 1&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDidentify;</span><span class="si">{Symbol_RESidentify}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;a1d2d03d-8c58-4c83-afa1-c40433fbd833&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 1&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 2&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDinfo;</span><span class="si">{Symbol_RESinfo}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;a1d2d03d-8c58-4c83-afa1-c40433fbd833&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 2&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 3&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDstats;</span><span class="si">{Symbol_RESstats}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;a1d2d03d-8c58-4c83-afa1-c40433fbd833&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 3&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 4&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDauthentify;</span><span class="si">{Symbol_RESauthentify}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;a1d2d03d-8c58-4c83-afa1-c40433fbd833&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 4&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 5&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDencrypt;</span><span class="si">{Symbol_RESencrypt}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;a1d2d03d-8c58-4c83-afa1-c40433fbd833&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 4&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 9&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDdecrypt;</span><span class="si">{Symbol_RESdecrypt}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;a1d2d03d-8c58-4c83-afa1-c40433fbd833&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 9&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 10&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDbye;</span><span class="si">{Symbol_RESbye}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;a1d2d03d-8c58-4c83-afa1-c40433fbd833&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 10&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;End state 11&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CloseChannelTransition&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;f7ddbccf-93b6-4496-a153-5b2306d95dac&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 5&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 6&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDdecrypt;</span><span class="si">{Symbol_RESdecrypt}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;a1d2d03d-8c58-4c83-afa1-c40433fbd833&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 6&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;State 7&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transition (Symbol_CMDbye;</span><span class="si">{Symbol_RESbye}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;a1d2d03d-8c58-4c83-afa1-c40433fbd833&quot;</span><span class="p">];</span>
<span class="s2">&quot;State 7&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;End state 8&quot;</span> <span class="p">[</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CloseChannelTransition&quot;</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="s2">&quot;f7ddbccf-93b6-4496-a153-5b2306d95dac&quot;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<figure class="align-center">
<a class="reference external image-reference" href="https://dev.netzob.org/attachments/download/174/automata_target_v1_pta.svg"><img alt="" src="https://dev.netzob.org/attachments/download/174/automata_target_v1_pta.svg" /></a>
</figure>
</section>
<section id="generate-messages-according-to-the-inferred-model">
<h2>Generate messages according to the inferred model<a class="headerlink" href="#generate-messages-according-to-the-inferred-model" title="Permalink to this headline">#</a></h2>
<p>We now have a pretty good knowledge of the format messsage and grammar of the targeted protocol. Let’s thus play with this model, by trying to communicate with a real server implementation.</p>
<p>At first, let’s start the server in order to discus with it.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd src_v1/
$ ./server

Ready to read incoming messages

(...)
</pre></div>
</div>
<p>Then, we create a UDP client that will communicate with the server (on 127.0.0.1:4242) by exchanging messages generated from the infered symbols:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a UDP client instance</span>
<span class="n">channelOut</span> <span class="o">=</span> <span class="n">UDPClient</span><span class="p">(</span><span class="n">remoteIP</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">remotePort</span><span class="o">=</span><span class="mi">4242</span><span class="p">)</span>
<span class="n">abstractionLayerOut</span> <span class="o">=</span> <span class="n">AbstractionLayer</span><span class="p">(</span><span class="n">channelOut</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">abstractionLayerOut</span><span class="o">.</span><span class="n">openChannel</span><span class="p">()</span>

<span class="c1"># Visit the automata for n iteration</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">automata</span><span class="o">.</span><span class="n">initialState</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">executeAsInitiator</span><span class="p">(</span><span class="n">abstractionLayerOut</span><span class="p">)</span>
</pre></div>
</div>
<p>We go through 8 iterations in the automaton.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1454</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">openChannel</span><span class="p">:</span> <span class="n">Going</span> <span class="n">to</span> <span class="nb">open</span> <span class="n">the</span> <span class="n">communication</span> <span class="n">channel</span><span class="o">...</span>
<span class="mi">1454</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">openChannel</span><span class="p">:</span> <span class="n">Communication</span> <span class="n">channel</span> <span class="n">opened</span><span class="o">.</span>
<span class="mi">1454</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">State</span><span class="p">:</span><span class="n">executeAsInitiator</span><span class="p">:</span> <span class="n">Next</span> <span class="n">transition</span><span class="p">:</span> <span class="n">Open</span><span class="o">.</span>
<span class="mi">1454</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">openChannel</span><span class="p">:</span> <span class="n">Going</span> <span class="n">to</span> <span class="nb">open</span> <span class="n">the</span> <span class="n">communication</span> <span class="n">channel</span><span class="o">...</span>
<span class="mi">1454</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">openChannel</span><span class="p">:</span> <span class="n">Communication</span> <span class="n">channel</span> <span class="n">opened</span><span class="o">.</span>
<span class="mi">1454</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">State</span><span class="p">:</span><span class="n">executeAsInitiator</span><span class="p">:</span> <span class="n">Transition</span> <span class="s1">&#39;Open&#39;</span> <span class="n">leads</span> <span class="n">to</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span> <span class="mf">1.</span>
<span class="mi">1455</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">State</span><span class="p">:</span><span class="n">executeAsInitiator</span><span class="p">:</span> <span class="n">Next</span> <span class="n">transition</span><span class="p">:</span> <span class="n">Transition</span><span class="o">.</span>
<span class="mi">1455</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">writeSymbol</span><span class="p">:</span> <span class="n">Going</span> <span class="n">to</span> <span class="n">specialize</span> <span class="n">symbol</span><span class="p">:</span> <span class="s1">&#39;Symbol_CMDidentify&#39;</span> <span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">dbea29b9</span><span class="o">-</span><span class="mf">7e9</span><span class="n">f</span><span class="o">-</span><span class="mi">4</span><span class="n">c2b</span><span class="o">-</span><span class="n">be14</span><span class="o">-</span><span class="mi">625</span><span class="n">f675569f3</span><span class="p">)</span><span class="o">.</span>
<span class="mi">1455</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">writeSymbol</span><span class="p">:</span> <span class="n">Data</span> <span class="n">generated</span> <span class="kn">from</span> <span class="nn">symbol</span> <span class="s1">&#39;Symbol_CMDidentify&#39;</span><span class="p">:</span> <span class="s1">&#39;CMDidentify#</span><span class="se">\x03\x00\x00\x00\xfc</span><span class="s1">{</span><span class="se">\xdb</span><span class="s1">&#39;</span><span class="o">.</span>
<span class="mi">1456</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">writeSymbol</span><span class="p">:</span> <span class="n">Going</span> <span class="n">to</span> <span class="n">write</span> <span class="n">to</span> <span class="n">communication</span> <span class="n">channel</span><span class="o">...</span>
<span class="mi">1456</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">writeSymbol</span><span class="p">:</span> <span class="n">Writing</span> <span class="n">to</span> <span class="n">commnunication</span> <span class="n">channel</span> <span class="n">donne</span><span class="o">..</span>
<span class="mi">1456</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">readSymbol</span><span class="p">:</span> <span class="n">Going</span> <span class="n">to</span> <span class="n">read</span> <span class="kn">from</span> <span class="nn">communication</span> <span class="n">channel</span><span class="o">...</span>
<span class="mi">1456</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">readSymbol</span><span class="p">:</span> <span class="n">Received</span> <span class="n">data</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="n">RESidentify</span><span class="c1">#\x00\x00\x00\x00\x00\x00\x00\x00&#39;&#39;</span>
<span class="mi">1457</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">readSymbol</span><span class="p">:</span> <span class="n">Received</span> <span class="n">symbol</span> <span class="n">on</span> <span class="n">communication</span> <span class="n">channel</span><span class="p">:</span> <span class="s1">&#39;Symbol_RESidentify&#39;</span>
<span class="mi">1457</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">Transition</span><span class="p">:</span><span class="n">executeAsInitiator</span><span class="p">:</span> <span class="n">Possible</span> <span class="n">output</span> <span class="n">symbol</span><span class="p">:</span> <span class="s1">&#39;Symbol_RESidentify&#39;</span> <span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">49</span><span class="n">c24e1c</span><span class="o">-</span><span class="mi">3751</span><span class="o">-</span><span class="mf">412e-9</span><span class="n">f6a</span><span class="o">-</span><span class="n">f006a7de7492</span><span class="p">)</span><span class="o">.</span>
<span class="mi">1457</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">State</span><span class="p">:</span><span class="n">executeAsInitiator</span><span class="p">:</span> <span class="n">Transition</span> <span class="s1">&#39;Transition&#39;</span> <span class="n">leads</span> <span class="n">to</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span> <span class="mf">2.</span>
<span class="mi">1457</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">State</span><span class="p">:</span><span class="n">executeAsInitiator</span><span class="p">:</span> <span class="n">Next</span> <span class="n">transition</span><span class="p">:</span> <span class="n">Transition</span><span class="o">.</span>
<span class="mi">1457</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">writeSymbol</span><span class="p">:</span> <span class="n">Going</span> <span class="n">to</span> <span class="n">specialize</span> <span class="n">symbol</span><span class="p">:</span> <span class="s1">&#39;Symbol_CMDinfo&#39;</span> <span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">5</span><span class="n">eb47a57</span><span class="o">-</span><span class="n">eccf</span><span class="o">-</span><span class="mi">4</span><span class="n">d06</span><span class="o">-</span><span class="mi">8231</span><span class="o">-</span><span class="mb">0b1</span><span class="n">ae87f96a7</span><span class="p">)</span><span class="o">.</span>
<span class="mi">1458</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">writeSymbol</span><span class="p">:</span> <span class="n">Data</span> <span class="n">generated</span> <span class="kn">from</span> <span class="nn">symbol</span> <span class="s1">&#39;Symbol_CMDinfo&#39;</span><span class="p">:</span> <span class="s1">&#39;CMDinfo#</span><span class="se">\x00\x00\x00\x00</span><span class="s1">&#39;</span><span class="o">.</span>
<span class="mi">1458</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">writeSymbol</span><span class="p">:</span> <span class="n">Going</span> <span class="n">to</span> <span class="n">write</span> <span class="n">to</span> <span class="n">communication</span> <span class="n">channel</span><span class="o">...</span>
<span class="mi">1458</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">writeSymbol</span><span class="p">:</span> <span class="n">Writing</span> <span class="n">to</span> <span class="n">commnunication</span> <span class="n">channel</span> <span class="n">donne</span><span class="o">..</span>
<span class="mi">1458</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">readSymbol</span><span class="p">:</span> <span class="n">Going</span> <span class="n">to</span> <span class="n">read</span> <span class="kn">from</span> <span class="nn">communication</span> <span class="n">channel</span><span class="o">...</span>
<span class="mi">1458</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">readSymbol</span><span class="p">:</span> <span class="n">Received</span> <span class="n">data</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="n">RESinfo</span><span class="c1">#\x00\x00\x00\x00\x04\x00\x00\x00info&#39;&#39;</span>
<span class="mi">1462</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">AbstractionLayer</span><span class="p">:</span><span class="n">readSymbol</span><span class="p">:</span> <span class="n">Received</span> <span class="n">symbol</span> <span class="n">on</span> <span class="n">communication</span> <span class="n">channel</span><span class="p">:</span> <span class="s1">&#39;Symbol_RESinfo&#39;</span>
<span class="mi">1462</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">Transition</span><span class="p">:</span><span class="n">executeAsInitiator</span><span class="p">:</span> <span class="n">Possible</span> <span class="n">output</span> <span class="n">symbol</span><span class="p">:</span> <span class="s1">&#39;Symbol_RESinfo&#39;</span> <span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">b41502e3</span><span class="o">-</span><span class="mi">21</span><span class="n">ea</span><span class="o">-</span><span class="mi">4</span><span class="n">cb9</span><span class="o">-</span><span class="mi">9</span><span class="n">c1e</span><span class="o">-</span><span class="n">dc171f715685</span><span class="p">)</span><span class="o">.</span>
<span class="mi">1462</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">State</span><span class="p">:</span><span class="n">executeAsInitiator</span><span class="p">:</span> <span class="n">Transition</span> <span class="s1">&#39;Transition&#39;</span> <span class="n">leads</span> <span class="n">to</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span> <span class="mf">3.</span>
<span class="mi">1462</span><span class="p">:</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">State</span><span class="p">:</span><span class="n">executeAsInitiator</span><span class="p">:</span> <span class="n">Next</span> <span class="n">transition</span><span class="p">:</span> <span class="n">Transition</span><span class="o">.</span>
<span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Regarding the real server, we can see that received messages are well formated, as the server is able to parse them and send correct responses.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./server

Ready to read incoming messages
-&gt; Read: CMDidentify#.
   Command: CMDidentify
   Arg size: 2
   Arg content: ..
&lt;- Send:
   Return value: 0
   Size of data buffer: 0
   Data buffer:
        &quot;&quot;

-&gt; Read: CMDinfo#
   Command: CMDinfo
   Arg size: 0
&lt;- Send:
   Return value: 0
   Size of data buffer: 4
   Data buffer:
   DATA: 69 6e 66 6f                                          &quot;info&quot;

-&gt; Read: CMDstats#
   Command: CMDstats
   Arg size: 0
&lt;- Send:
   Return value: 0
   Size of data buffer: 5
   Data buffer:
   DATA: 73 74 61 74 73                                       &quot;stats&quot;

-&gt; Read: CMDauthentify#.
   Command: CMDauthentify
   Arg size: 6
   Arg content: ......
&lt;- Send:
   Return value: 0
   Size of data buffer: 0
   Data buffer:
      &quot;&quot;

-&gt; Read: CMDencrypt#.
   Command: CMDencrypt
   Arg size: 2
   Arg content: ..
&lt;- Send:
(...)
</pre></div>
</div>
</section>
<section id="do-some-fuzzing-on-a-specific-symbol">
<h2>Do some fuzzing on a specific symbol<a class="headerlink" href="#do-some-fuzzing-on-a-specific-symbol" title="Permalink to this headline">#</a></h2>
<p>Finally, we voluntarily twist the format message of the ‘CMDencrypt’ symbol, in order to try some fuzzing. The format modification corresponds to an extention of the size of the buffer field (i.e. the one which receives the data to encrypt):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">send_and_receive_symbol</span><span class="p">(</span><span class="n">symbol</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">.</span><span class="n">specialize</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Sending: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
    <span class="n">channelOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">channelOut</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Receiving: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>

<span class="c1"># Update symbol definition to allow a broader payload size</span>
<span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;CMDencrypt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">Raw</span><span class="p">(</span><span class="n">nbBytes</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">120</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">send_and_receive_symbol</span><span class="p">(</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;CMDencrypt&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>We can see that Netzob is only sending CMDencrypt messages with a potentially long last field:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Sending</span><span class="p">:</span> <span class="s1">&#39;CMDencrypt#6</span><span class="se">\x00\x00\x00</span><span class="s1">&amp;</span><span class="se">\xe0</span><span class="s1">*</span><span class="se">\xb3\xa8</span><span class="s1">A(</span><span class="se">\x0b\xd2</span><span class="s1">yA</span><span class="se">\xb5\xb8\r</span><span class="s1">w</span><span class="se">\x0f</span><span class="s1">Gi</span><span class="se">\xee\xb3\xd6\xb0</span><span class="s1">&lt;</span><span class="se">\xfc\xc0\xa7</span><span class="s1">m</span><span class="se">\xbd\xbc\xde</span><span class="s1">2~</span><span class="se">\xce</span><span class="s1">E</span><span class="se">\xe5\xda</span><span class="s1">@</span><span class="se">\xd4\xed\xed\xf2\xb4\xe7\t\xfb</span><span class="s1">C</span><span class="se">\xbf\x05\xc6\xce\xfb\x83\xf2\x00</span><span class="s1">&#39;</span>
<span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>In the server part, we quickly get a segmentation fault, due to a bug in the parsing of the last field.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ gdb ./server
(gdb) run
Starting program: /home/fgy/travaux/netzob/git/netzob-resources/experimentations/tutorial_target/src_v1/server

Ready to read incoming messages
(...)
-&gt; Read: CMDencrypt#6
   Command: CMDencrypt
   Arg size: 54
   Arg content: &amp;?*??A(
wGi???&lt;???m???2~?E??@????????    ?C??

Program received signal SIGSEGV, Segmentation fault.
0x08048bc0 in api_encrypt (in=0x45ce7e32 &lt;Address 0x45ce7e32 out of bounds&gt;, len=3561020133, out=0xb4f2eded &lt;Address 0xb4f2eded out of bounds&gt;) at amo_api.c:80
 80         tmpData[i] = (in[i] ^ key) % 0xff;
</pre></div>
</div>
<p>That’s all folks for this introduction tutorial. You can get the entire <a class="reference external" href="https://dev.netzob.org/attachments/download/183/inference_target_src_v1.py">source code</a> of the script used to infer and play with the protocol:</p>
<p>We invite you to read the API documentation or talk with us on IRC (#netzob on Freenode) if you have any question.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
      &copy; Copyright 2011-2022, Frédéric Guihéry, Georges Bossert.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>